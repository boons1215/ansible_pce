❯ ansible-playbook -i hosts pce-build/site.yml -u centos --private-key wwest-default -e "@setup-vars.yml"

PLAY [>>>>>>>> ALL NODES: Check OS version and package dependencies] **********************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************
ok: [172.16.3.237]
ok: [172.16.3.234]
ok: [172.16.3.235]
ok: [172.16.3.236]

TASK [1_COMMON : Check OS version on nodes] ***********************************************************************************************************************************************************************
ok: [172.16.3.236]
ok: [172.16.3.237]
ok: [172.16.3.235]
ok: [172.16.3.234]

TASK [1_COMMON : assert] ******************************************************************************************************************************************************************************************
ok: [172.16.3.234] => {
    "changed": false,
    "msg": "CentOS 7.9 is supported"
}
ok: [172.16.3.235] => {
    "changed": false,
    "msg": "CentOS 7.9 is supported"
}
ok: [172.16.3.236] => {
    "changed": false,
    "msg": "CentOS 7.9 is supported"
}
ok: [172.16.3.237] => {
    "changed": false,
    "msg": "CentOS 7.9 is supported"
}

TASK [1_COMMON : Check and install package dependencies] **********************************************************************************************************************************************************
ok: [172.16.3.235] => (item=bash)
ok: [172.16.3.237] => (item=bash)
ok: [172.16.3.234] => (item=bash)
ok: [172.16.3.236] => (item=bash)
ok: [172.16.3.235] => (item=bind-utils)
ok: [172.16.3.237] => (item=bind-utils)
ok: [172.16.3.234] => (item=bind-utils)
ok: [172.16.3.236] => (item=bind-utils)
ok: [172.16.3.237] => (item=bzip2)
ok: [172.16.3.234] => (item=bzip2)
ok: [172.16.3.235] => (item=bzip2)
ok: [172.16.3.236] => (item=bzip2)
ok: [172.16.3.234] => (item=ca-certificates)
ok: [172.16.3.237] => (item=ca-certificates)
ok: [172.16.3.235] => (item=ca-certificates)
ok: [172.16.3.236] => (item=ca-certificates)
ok: [172.16.3.234] => (item=chkconfig)
ok: [172.16.3.237] => (item=chkconfig)
ok: [172.16.3.235] => (item=chkconfig)
ok: [172.16.3.236] => (item=chkconfig)
ok: [172.16.3.234] => (item=coreutils)
ok: [172.16.3.236] => (item=coreutils)
ok: [172.16.3.235] => (item=coreutils)
ok: [172.16.3.237] => (item=coreutils)
ok: [172.16.3.234] => (item=curl)
ok: [172.16.3.235] => (item=curl)
ok: [172.16.3.236] => (item=curl)
ok: [172.16.3.237] => (item=curl)
ok: [172.16.3.234] => (item=findutils)
ok: [172.16.3.236] => (item=findutils)
ok: [172.16.3.237] => (item=findutils)
ok: [172.16.3.235] => (item=findutils)
ok: [172.16.3.234] => (item=gawk)
ok: [172.16.3.236] => (item=gawk)
ok: [172.16.3.237] => (item=gawk)
ok: [172.16.3.235] => (item=gawk)
ok: [172.16.3.234] => (item=grep)
ok: [172.16.3.236] => (item=grep)
ok: [172.16.3.237] => (item=grep)
ok: [172.16.3.235] => (item=grep)
ok: [172.16.3.234] => (item=gzip)
ok: [172.16.3.236] => (item=gzip)
ok: [172.16.3.237] => (item=gzip)
ok: [172.16.3.235] => (item=gzip)
ok: [172.16.3.234] => (item=initscripts)
ok: [172.16.3.236] => (item=initscripts)
ok: [172.16.3.237] => (item=initscripts)
ok: [172.16.3.235] => (item=initscripts)
ok: [172.16.3.234] => (item=libuuid)
ok: [172.16.3.236] => (item=libuuid)
ok: [172.16.3.237] => (item=libuuid)
ok: [172.16.3.235] => (item=libuuid)
ok: [172.16.3.234] => (item=logrotate)
ok: [172.16.3.236] => (item=logrotate)
ok: [172.16.3.237] => (item=logrotate)
ok: [172.16.3.235] => (item=logrotate)
ok: [172.16.3.234] => (item=net-tools)
ok: [172.16.3.236] => (item=net-tools)
ok: [172.16.3.237] => (item=net-tools)
ok: [172.16.3.235] => (item=net-tools)
^@ok: [172.16.3.234] => (item=ntp)
ok: [172.16.3.236] => (item=ntp)
ok: [172.16.3.237] => (item=ntp)
ok: [172.16.3.235] => (item=ntp)
ok: [172.16.3.234] => (item=procps-ng)
ok: [172.16.3.236] => (item=procps-ng)
ok: [172.16.3.237] => (item=procps-ng)
ok: [172.16.3.235] => (item=procps-ng)
ok: [172.16.3.234] => (item=sed)
ok: [172.16.3.236] => (item=sed)
ok: [172.16.3.237] => (item=sed)
ok: [172.16.3.235] => (item=sed)
ok: [172.16.3.234] => (item=tar)
ok: [172.16.3.236] => (item=tar)
ok: [172.16.3.237] => (item=tar)
ok: [172.16.3.235] => (item=tar)
ok: [172.16.3.234] => (item=util-linux)
ok: [172.16.3.236] => (item=util-linux)
ok: [172.16.3.237] => (item=util-linux)
ok: [172.16.3.235] => (item=util-linux)

TASK [1_COMMON : Check and install lib dependencies] **************************************************************************************************************************************************************
ok: [172.16.3.237] => (item=glibc)
ok: [172.16.3.235] => (item=glibc)
ok: [172.16.3.234] => (item=glibc)
ok: [172.16.3.236] => (item=glibc)
ok: [172.16.3.234] => (item=libgcc)
ok: [172.16.3.237] => (item=libgcc)
ok: [172.16.3.236] => (item=libgcc)
ok: [172.16.3.235] => (item=libgcc)
ok: [172.16.3.234] => (item=libselinux)
ok: [172.16.3.236] => (item=libselinux)
ok: [172.16.3.235] => (item=libselinux)
ok: [172.16.3.237] => (item=libselinux)
ok: [172.16.3.234] => (item=libstdc++)
ok: [172.16.3.236] => (item=libstdc++)
ok: [172.16.3.237] => (item=libstdc++)
ok: [172.16.3.235] => (item=libstdc++)
ok: [172.16.3.234] => (item=ncurses-libs)
ok: [172.16.3.236] => (item=ncurses-libs)
ok: [172.16.3.235] => (item=ncurses-libs)
ok: [172.16.3.237] => (item=ncurses-libs)
ok: [172.16.3.234] => (item=openssl)
ok: [172.16.3.236] => (item=openssl)
ok: [172.16.3.235] => (item=openssl)
ok: [172.16.3.237] => (item=openssl)
ok: [172.16.3.234] => (item=readline)
ok: [172.16.3.236] => (item=readline)
ok: [172.16.3.237] => (item=readline)
ok: [172.16.3.235] => (item=readline)
ok: [172.16.3.234] => (item=shadow-utils)
ok: [172.16.3.236] => (item=shadow-utils)
ok: [172.16.3.237] => (item=shadow-utils)
ok: [172.16.3.235] => (item=shadow-utils)
ok: [172.16.3.234] => (item=zlib)
ok: [172.16.3.236] => (item=zlib)
ok: [172.16.3.237] => (item=zlib)
ok: [172.16.3.235] => (item=zlib)

PLAY [>>>>>>>> ALL NODES: Install PCE RPM, set hostname, stop firewalld, copy certs, set locale and enable ntp] ***************************************************************************************************

TASK [2_INIT : Stop iptables service] *****************************************************************************************************************************************************************************
fatal: [172.16.3.236]: FAILED! => {"changed": false, "msg": "Could not find the requested service iptables: host"}
...ignoring
fatal: [172.16.3.234]: FAILED! => {"changed": false, "msg": "Could not find the requested service iptables: host"}
...ignoring
fatal: [172.16.3.235]: FAILED! => {"changed": false, "msg": "Could not find the requested service iptables: host"}
...ignoring
fatal: [172.16.3.237]: FAILED! => {"changed": false, "msg": "Could not find the requested service iptables: host"}
...ignoring

TASK [2_INIT : Stop firewalld service] ****************************************************************************************************************************************************************************
^@ok: [172.16.3.236]
ok: [172.16.3.234]
ok: [172.16.3.237]
ok: [172.16.3.235]

TASK [2_INIT : Put SELinux in permissive mode] ********************************************************************************************************************************************************************
ok: [172.16.3.234]
ok: [172.16.3.236]
ok: [172.16.3.237]
ok: [172.16.3.235]

TASK [2_INIT : Get current locale and language configuration] *****************************************************************************************************************************************************
ok: [172.16.3.236]
ok: [172.16.3.234]
ok: [172.16.3.237]
ok: [172.16.3.235]

TASK [2_INIT : Parse 'LANG' from current locale and language configuration] ***************************************************************************************************************************************
ok: [172.16.3.234]
ok: [172.16.3.235]
ok: [172.16.3.236]
ok: [172.16.3.237]

TASK [2_INIT : Configure locale to 'en_US.UTF-8'] *****************************************************************************************************************************************************************
ok: [172.16.3.236]
ok: [172.16.3.237]
ok: [172.16.3.234]
ok: [172.16.3.235]

TASK [2_INIT : Set /etc/environment] ******************************************************************************************************************************************************************************
ok: [172.16.3.236]
ok: [172.16.3.234]
ok: [172.16.3.237]
ok: [172.16.3.235]

TASK [2_INIT : Copy root CA certs to /etc/pki/ca-trust/source/anchors/] *******************************************************************************************************************************************
ok: [172.16.3.234]
ok: [172.16.3.237]
ok: [172.16.3.236]
ok: [172.16.3.235]

TASK [2_INIT : Copy intermediate CA certs to /etc/pki/ca-trust/source/anchors/] ***********************************************************************************************************************************
ok: [172.16.3.236]
ok: [172.16.3.237]
ok: [172.16.3.234]
ok: [172.16.3.235]

TASK [2_INIT : Update-ca-trust force-enable] **********************************************************************************************************************************************************************
changed: [172.16.3.234]
changed: [172.16.3.236]
changed: [172.16.3.237]
changed: [172.16.3.235]

TASK [2_INIT : Update-ca-trust extract] ***************************************************************************************************************************************************************************
changed: [172.16.3.236]
changed: [172.16.3.234]
changed: [172.16.3.237]
changed: [172.16.3.235]

TASK [2_INIT : Ensure NTP service is enabled (use default in /etc/ntp.conf)] **************************************************************************************************************************************
changed: [172.16.3.234]
changed: [172.16.3.236]
changed: [172.16.3.237]
changed: [172.16.3.235]

TASK [2_INIT : Make sure Chrony is started up] ********************************************************************************************************************************************************************
changed: [172.16.3.234]
changed: [172.16.3.236]
changed: [172.16.3.235]
changed: [172.16.3.237]

TASK [2_INIT : Set timezone 'Asia/Singapore'] *********************************************************************************************************************************************************************
changed: [172.16.3.234]
changed: [172.16.3.236]
changed: [172.16.3.235]
changed: [172.16.3.237]

TASK [2_INIT : Check RPM file - 'illumio-pce-21.2.7-656.c6.x86_64.rpm' already copied] ****************************************************************************************************************************
ok: [172.16.3.234]
ok: [172.16.3.237]
ok: [172.16.3.236]
ok: [172.16.3.235]

TASK [2_INIT : Copy PCE RPM - 'illumio-pce-21.2.7-656.c6.x86_64.rpm' to /tmp] *************************************************************************************************************************************
skipping: [172.16.3.234]
skipping: [172.16.3.235]
skipping: [172.16.3.236]
skipping: [172.16.3.237]

TASK [2_INIT : Install PCE RPM - 'illumio-pce-21.2.7-656.c6.x86_64.rpm'] ******************************************************************************************************************************************
^@changed: [172.16.3.237]
changed: [172.16.3.236]
changed: [172.16.3.234]
changed: [172.16.3.235]

TASK [2_INIT : Make sure PCE RPM has installed] *******************************************************************************************************************************************************************
ok: [172.16.3.234]
ok: [172.16.3.237]
ok: [172.16.3.236]
ok: [172.16.3.235]

PLAY [>>>>>>>> CORE NODES: Install PCE-UI RPM] ********************************************************************************************************************************************************************

TASK [3_PCE-UI_INSTALL : Check RPM file - 'illumio-pce-ui-21.2.7.UI1-284.x86_64.rpm' already copied] **************************************************************************************************************
ok: [172.16.3.234]
ok: [172.16.3.235]

TASK [3_PCE-UI_INSTALL : Copy PCE-UI RPM - 'illumio-pce-ui-21.2.7.UI1-284.x86_64.rpm' to /tmp] ********************************************************************************************************************
skipping: [172.16.3.234]
skipping: [172.16.3.235]

TASK [3_PCE-UI_INSTALL : Install PCE-UI RPM - 'illumio-pce-ui-21.2.7.UI1-284.x86_64.rpm'] *************************************************************************************************************************
changed: [172.16.3.234]
changed: [172.16.3.235]

TASK [3_PCE-UI_INSTALL : Make sure PCE-UI RPM has installed] ******************************************************************************************************************************************************
ok: [172.16.3.234]
ok: [172.16.3.235]

PLAY [>>>>>>>> ALL NODES: Set and Verify Process and File Limits with systemd] ************************************************************************************************************************************

TASK [4_SET_SYSTEMD : Create /etc/systemd/system/illumio-pce.service.d/override.conf] *****************************************************************************************************************************
changed: [172.16.3.234]
changed: [172.16.3.237]
changed: [172.16.3.236]
changed: [172.16.3.235]

TASK [4_SET_SYSTEMD : Set systemd limits] *************************************************************************************************************************************************************************
changed: [172.16.3.236]
changed: [172.16.3.234]
changed: [172.16.3.237]
changed: [172.16.3.235]

PLAY [>>>>>>>> CORE NODES: Set OS kernel parameters] **************************************************************************************************************************************************************

TASK [5_SET_KERNEL_CORE : Create /etc/sysctl.d/99-illumio.conf] ***************************************************************************************************************************************************
changed: [172.16.3.234]
changed: [172.16.3.235]

TASK [5_SET_KERNEL_CORE : Load nf_conntrack module] ***************************************************************************************************************************************************************
^@changed: [172.16.3.234]
changed: [172.16.3.235]

TASK [5_SET_KERNEL_CORE : Set OS kernel parameters] ***************************************************************************************************************************************************************
ok: [172.16.3.234]
ok: [172.16.3.235]

TASK [5_SET_KERNEL_CORE : Apply the OS kernel settings] ***********************************************************************************************************************************************************
changed: [172.16.3.234]
changed: [172.16.3.235]

TASK [5_SET_KERNEL_CORE : Get current nf_conntrack hashsize] ******************************************************************************************************************************************************
ok: [172.16.3.234]
ok: [172.16.3.235]

TASK [5_SET_KERNEL_CORE : Set nf_conntrack hashsize to 262144] ****************************************************************************************************************************************************
skipping: [172.16.3.234]
skipping: [172.16.3.235]

TASK [5_SET_KERNEL_CORE : Create /etc/modprobe.d/illumio.conf] ****************************************************************************************************************************************************
changed: [172.16.3.234]
changed: [172.16.3.235]

TASK [5_SET_KERNEL_CORE : Apply the hash size settings in module] *************************************************************************************************************************************************
ok: [172.16.3.234]
ok: [172.16.3.235]

PLAY [>>>>>>>> DATA NODES: Set OS kernel parameters] **************************************************************************************************************************************************************

TASK [6_SET_KERNEL_DATA : Create /etc/sysctl.d/99-illumio.conf] ***************************************************************************************************************************************************
changed: [172.16.3.236]
changed: [172.16.3.237]

TASK [6_SET_KERNEL_DATA : Set OS kernel parameters] ***************************************************************************************************************************************************************
ok: [172.16.3.236]
ok: [172.16.3.237]

TASK [6_SET_KERNEL_DATA : Apply the settings] *********************************************************************************************************************************************************************
changed: [172.16.3.237]
changed: [172.16.3.236]

PLAY [>>>>>>>> ALL NODES: PCE cluster setup] **********************************************************************************************************************************************************************

TASK [7_CLUSTER_SETUP : Copy private key to /var/lib/illumio-pce/cert/, rename to server.crt] *********************************************************************************************************************
changed: [172.16.3.234]
changed: [172.16.3.237]
changed: [172.16.3.236]
changed: [172.16.3.235]

TASK [7_CLUSTER_SETUP : Copy cert bundle to /var/lib/illumio-pce/cert/, rename to server.key] *********************************************************************************************************************
changed: [172.16.3.234]
changed: [172.16.3.236]
changed: [172.16.3.237]
changed: [172.16.3.235]

TASK [7_CLUSTER_SETUP : Set node hostname which defined in the host inventory] ************************************************************************************************************************************
ok: [172.16.3.234]
ok: [172.16.3.236]
ok: [172.16.3.235]
ok: [172.16.3.237]

TASK [7_CLUSTER_SETUP : Update /etc/hosts to include all nodes] ***************************************************************************************************************************************************
ok: [172.16.3.234]
ok: [172.16.3.236]
ok: [172.16.3.237]
ok: [172.16.3.235]

TASK [7_CLUSTER_SETUP : Set fact variable - node type 'core'] *****************************************************************************************************************************************************
skipping: [172.16.3.234] => (item=allnodes)
ok: [172.16.3.234] => (item=core0)
skipping: [172.16.3.234] => (item=corenodes)
skipping: [172.16.3.235] => (item=allnodes)
ok: [172.16.3.235] => (item=core1)
skipping: [172.16.3.235] => (item=corenodes)
skipping: [172.16.3.236] => (item=allnodes)
skipping: [172.16.3.236] => (item=data0)
skipping: [172.16.3.236] => (item=datanodes)
skipping: [172.16.3.237] => (item=allnodes)
skipping: [172.16.3.237] => (item=data1)
skipping: [172.16.3.237] => (item=datanodes)

TASK [7_CLUSTER_SETUP : Set fact variable - node type 'data'] *****************************************************************************************************************************************************
skipping: [172.16.3.234] => (item=allnodes)
skipping: [172.16.3.234] => (item=core0)
skipping: [172.16.3.234] => (item=corenodes)
skipping: [172.16.3.235] => (item=allnodes)
skipping: [172.16.3.235] => (item=core1)
skipping: [172.16.3.235] => (item=corenodes)
skipping: [172.16.3.236] => (item=allnodes)
ok: [172.16.3.236] => (item=data0)
skipping: [172.16.3.236] => (item=datanodes)
skipping: [172.16.3.237] => (item=allnodes)
ok: [172.16.3.237] => (item=data1)
skipping: [172.16.3.237] => (item=datanodes)

TASK [7_CLUSTER_SETUP : Copy runtime_env.yml template to PCE] *****************************************************************************************************************************************************
^@changed: [172.16.3.234]
changed: [172.16.3.236]
changed: [172.16.3.237]
changed: [172.16.3.235]

TASK [7_CLUSTER_SETUP : Running illumio-pce-env check before starting cluster] ************************************************************************************************************************************
ok: [172.16.3.237]
ok: [172.16.3.234]
ok: [172.16.3.236]
ok: [172.16.3.235]

TASK [7_CLUSTER_SETUP : Running illumio-pce-ctl status to check init runlevel] ************************************************************************************************************************************
ok: [172.16.3.237]
ok: [172.16.3.236]
ok: [172.16.3.235]
ok: [172.16.3.234]

TASK [7_CLUSTER_SETUP : Start PCE runlevel 1] *********************************************************************************************************************************************************************
changed: [172.16.3.236]
changed: [172.16.3.237]
changed: [172.16.3.234]
changed: [172.16.3.235]

TASK [7_CLUSTER_SETUP : Wait for the PCE to start as runlevel 1] **************************************************************************************************************************************************
FAILED - RETRYING: Wait for the PCE to start as runlevel 1 (3 retries left).
FAILED - RETRYING: Wait for the PCE to start as runlevel 1 (3 retries left).
FAILED - RETRYING: Wait for the PCE to start as runlevel 1 (3 retries left).
FAILED - RETRYING: Wait for the PCE to start as runlevel 1 (3 retries left).
^@^@changed: [172.16.3.234]
changed: [172.16.3.237]
changed: [172.16.3.236]
changed: [172.16.3.235]

PLAY [>>>>>>>> DATA 0: Bring up DB and set runlevel 5] ************************************************************************************************************************************************************

TASK [8_INIT_DB : Initialize the PCE database] ********************************************************************************************************************************************************************
^@changed: [172.16.3.236]

TASK [8_INIT_DB : Bring the system up to runlevel 5] **************************************************************************************************************************************************************
ok: [172.16.3.236]

TASK [8_INIT_DB : Wait for the PCE cluster to be up] **************************************************************************************************************************************************************
^@changed: [172.16.3.236]

PLAY [>>>>>>>> CORE 0: Setup first local user, install VEN library bundle and validate the cluster service] *******************************************************************************************************

TASK [9_SET_USER_VENLIB : Creating org and adding first user with illumio-pce-db-management] **********************************************************************************************************************
changed: [172.16.3.234]

TASK [9_SET_USER_VENLIB : Copy VEN bundle - 'illumio-ven-bundle-21.2.5-8017.tar.bz2' to /tmp] *********************************************************************************************************************
ok: [172.16.3.234]

TASK [9_SET_USER_VENLIB : Check VEN bundle - 'illumio-ven-bundle-21.2.5-8017.tar.bz2' already copied] *************************************************************************************************************
^@ok: [172.16.3.234]

TASK [9_SET_USER_VENLIB : Copy VEN compatibility matrix - 'illumio-release-compatibility-20-186.tar.bz2' to /tmp] *************************************************************************************************
ok: [172.16.3.234]

TASK [9_SET_USER_VENLIB : Check VEN compatibility matrix - 'illumio-release-compatibility-20-186.tar.bz2' already copied] *****************************************************************************************
ok: [172.16.3.234]

TASK [9_SET_USER_VENLIB : Install VEN bundle] *********************************************************************************************************************************************************************
^@changed: [172.16.3.234]

TASK [9_SET_USER_VENLIB : Validation: Login with Username and Password] *******************************************************************************************************************************************
ok: [172.16.3.234]

PLAY RECAP ********************************************************************************************************************************************************************************************************
172.16.3.234               : ok=51   changed=20   unreachable=0    failed=0    skipped=4    rescued=0    ignored=1
172.16.3.235               : ok=44   changed=18   unreachable=0    failed=0    skipped=4    rescued=0    ignored=1
172.16.3.236               : ok=40   changed=17   unreachable=0    failed=0    skipped=2    rescued=0    ignored=1
172.16.3.237               : ok=37   changed=15   unreachable=0    failed=0    skipped=2    rescued=0    ignored=1